# Database Configuration# RustCare Engine - Development Environment Configuration

DATABASE_URL=postgresql://postgres:admin@localhost:5432/rustcare_dev# Copy this file to .env and customize for your local setup



# Redis Configuration (for sessions)# =============================================================================

REDIS_URL=redis://localhost:6379# DATABASE CONFIGURATION

# =============================================================================

# JWT ConfigurationDATABASE_URL=postgresql://rustcare:rustcare_dev_password_change_in_prod@localhost:5432/rustcare_dev

JWT_SECRET=your-secret-key-change-in-productionDATABASE_MAX_CONNECTIONS=20

JWT_EXPIRATION_MINUTES=5DATABASE_MIN_CONNECTIONS=5

REFRESH_TOKEN_EXPIRATION_DAYS=30DATABASE_ACQUIRE_TIMEOUT=30

DATABASE_IDLE_TIMEOUT=600

# Server ConfigurationDATABASE_MAX_LIFETIME=1800

SERVER_HOST=0.0.0.0

SERVER_PORT=8080# =============================================================================

# REDIS CONFIGURATION (Session Storage)

# Encryption# =============================================================================

MASTER_ENCRYPTION_KEY=your-master-key-change-in-productionREDIS_URL=redis://localhost:6379

REDIS_MAX_CONNECTIONS=10

# CORSREDIS_CONNECTION_TIMEOUT=5

CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080REDIS_POOL_TIMEOUT=10



# Logging# =============================================================================

RUST_LOG=info,rustcare_server=debug,database_layer=debug# JWT CONFIGURATION

# =============================================================================

# HIPAA ComplianceJWT_ACCESS_TOKEN_EXPIRY=900           # 15 minutes

AUDIT_RETENTION_DAYS=2555  # 7 years for HIPAAJWT_REFRESH_TOKEN_EXPIRY=2592000     # 30 days

PHI_MASKING_ENABLED=trueJWT_ISSUER=rustcare-engine

JWT_AUDIENCE=rustcare-api

# Zanzibar (optional)JWT_ALGORITHM=RS256

ZANZIBAR_URL=http://localhost:8081

ZANZIBAR_API_KEY=your-zanzibar-api-key# JWT Key Storage (will be generated on first run)

JWT_PRIVATE_KEY_PATH=./config/keys/jwt-private.pem
JWT_PUBLIC_KEY_PATH=./config/keys/jwt-public.pem

# =============================================================================
# SESSION CONFIGURATION
# =============================================================================
SESSION_IDLE_TIMEOUT_MINUTES=30
SESSION_MAX_CONCURRENT_PER_USER=5
SESSION_VERIFY_IP=true
SESSION_VERIFY_USER_AGENT=true
SESSION_VERIFY_DEVICE_FINGERPRINT=true

# =============================================================================
# AUTHENTICATION PROVIDERS
# =============================================================================

# Email/Password
EMAIL_PASSWORD_ENABLED=true
EMAIL_PASSWORD_MIN_LENGTH=12
EMAIL_PASSWORD_REQUIRE_UPPERCASE=true
EMAIL_PASSWORD_REQUIRE_LOWERCASE=true
EMAIL_PASSWORD_REQUIRE_NUMBERS=true
EMAIL_PASSWORD_REQUIRE_SPECIAL=true
EMAIL_PASSWORD_MAX_LOGIN_ATTEMPTS=5
EMAIL_PASSWORD_LOCKOUT_DURATION_MINUTES=15

# OAuth (Google)
OAUTH_GOOGLE_ENABLED=true
OAUTH_GOOGLE_CLIENT_ID=your_google_client_id
OAUTH_GOOGLE_CLIENT_SECRET=your_google_client_secret
OAUTH_GOOGLE_REDIRECT_URL=http://localhost:3000/auth/oauth/google/callback

# OAuth (Microsoft)
OAUTH_MICROSOFT_ENABLED=false
OAUTH_MICROSOFT_CLIENT_ID=your_microsoft_client_id
OAUTH_MICROSOFT_CLIENT_SECRET=your_microsoft_client_secret
OAUTH_MICROSOFT_REDIRECT_URL=http://localhost:3000/auth/oauth/microsoft/callback

# OAuth (GitHub)
OAUTH_GITHUB_ENABLED=false
OAUTH_GITHUB_CLIENT_ID=your_github_client_id
OAUTH_GITHUB_CLIENT_SECRET=your_github_client_secret
OAUTH_GITHUB_REDIRECT_URL=http://localhost:3000/auth/oauth/github/callback

# Certificate (mTLS)
CERT_ENABLED=false
CERT_CA_ROOTS_PATH=./config/ca-certificates/roots
CERT_VERIFY_CHAIN=true
CERT_CHECK_REVOCATION=true

# =============================================================================
# RATE LIMITING
# =============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_LOGIN_MAX_REQUESTS=5
RATE_LIMIT_LOGIN_WINDOW_SECONDS=900      # 15 minutes
RATE_LIMIT_API_MAX_REQUESTS=100
RATE_LIMIT_API_WINDOW_SECONDS=60        # 1 minute

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================
SERVER_HOST=0.0.0.0
SERVER_PORT=3000
SERVER_WORKERS=4
SERVER_KEEP_ALIVE=75
SERVER_REQUEST_TIMEOUT=30

# =============================================================================
# CORS CONFIGURATION
# =============================================================================
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-Request-ID
CORS_MAX_AGE=3600

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
RUST_LOG=info,rustcare_server=debug,sqlx=warn
LOG_FORMAT=json                          # 'json' or 'pretty'
LOG_OUTPUT=stdout                        # 'stdout', 'file', or 'both'
LOG_FILE_PATH=./logs/rustcare.log

# =============================================================================
# ENCRYPTION CONFIGURATION
# =============================================================================

# Enable field-level encryption
ENCRYPTION_ENABLED=true

# Encryption algorithm (aes-256-gcm, aes-256-cbc, chacha20-poly1305)
ENCRYPTION_ALGORITHM=aes-256-gcm

# Master encryption key for AES-256-GCM (32 bytes, base64-encoded)
# Generate with: openssl rand -base64 32
MASTER_ENCRYPTION_KEY=CHANGE_ME_generate_with_openssl_rand_base64_32

# Current key version (for rotation support)
ENCRYPTION_KEY_VERSION=1

# Enable envelope encryption (DEK/KEK pattern) for large objects
ENABLE_ENVELOPE_ENCRYPTION=true

# Threshold for envelope encryption (bytes) - objects larger than this use envelope encryption
ENVELOPE_THRESHOLD_BYTES=1048576  # 1 MB

# Deprecated - use MASTER_ENCRYPTION_KEY instead
# DATABASE_MASTER_KEY=change_me_generate_with_openssl_rand_hex_32

# =============================================================================
# KEY MANAGEMENT SERVICE (KMS) CONFIGURATION
# =============================================================================

# KMS Provider: aws_kms | vault | local | none
KMS_PROVIDER=none

# --- AWS KMS Configuration (when KMS_PROVIDER=aws_kms) ---
# AWS KMS Key ID or ARN
# AWS_KMS_KEY_ID=arn:aws:kms:us-east-1:123456789012:key/12345678-1234-1234-1234-123456789012
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=your_access_key_id
# AWS_SECRET_ACCESS_KEY=your_secret_access_key
# AWS_KMS_TIMEOUT_SECONDS=30
# AWS_KMS_ENABLE_ROTATION=true

# --- HashiCorp Vault Configuration (when KMS_PROVIDER=vault) ---
# VAULT_ADDR=https://vault.company.com:8200
# VAULT_TOKEN=s.xyz123...
# VAULT_MOUNT_PATH=transit
# VAULT_KEY_NAME=rustcare-master-key
# VAULT_TIMEOUT_SECONDS=30
# VAULT_VERIFY_TLS=true
# VAULT_CA_CERT_PATH=/path/to/ca-cert.pem

# --- Local Key Storage (when KMS_PROVIDER=local, DEVELOPMENT ONLY) ---
# LOCAL_KEY_PATH=./config/keys/master.key

# =============================================================================
# MEMORY SECURITY CONFIGURATION
# =============================================================================

# Enable memory locking (mlock) to prevent keys from being swapped to disk
ENABLE_MEMORY_LOCKING=true

# Enable constant-time operations to prevent timing attacks
ENABLE_CONSTANT_TIME_OPS=true

# Enable guard pages for buffer overflow detection
ENABLE_GUARD_PAGES=true

# =============================================================================
# DATABASE ENCRYPTION (TDE - Transparent Data Encryption)
# =============================================================================

# Enable PostgreSQL Transparent Data Encryption
ENABLE_DATABASE_TDE=false

# Database encryption key (separate from object encryption, 32 bytes base64)
# DATABASE_ENCRYPTION_KEY=

# =============================================================================
# OBJECT STORAGE ENCRYPTION
# =============================================================================

# Storage backend: filesystem | s3
STORAGE_BACKEND=filesystem

# Encryption threshold for object storage (bytes)
# Objects smaller than this may skip encryption for performance
STORAGE_ENCRYPTION_THRESHOLD=1048576  # 1 MB

# Enable client-side encryption for S3
ENABLE_S3_CLIENT_SIDE_ENCRYPTION=true

# S3 Configuration (when STORAGE_BACKEND=s3)
# S3_BUCKET=rustcare-prod-data
# S3_REGION=us-east-1
# S3_ACCESS_KEY_ID=
# S3_SECRET_ACCESS_KEY=
# S3_ENDPOINT=  # Optional: custom S3-compatible endpoint

# =============================================================================
# COMPLIANCE & AUDIT
# =============================================================================

# Enable FIPS 140-2 mode (if available)
ENABLE_FIPS_MODE=false

# Security audit log path
# SECURITY_AUDIT_LOG=/var/log/rustcare/security.log

# Enable detailed cryptographic operation logging
ENABLE_CRYPTO_AUDIT=false

# Key rotation interval (days)
KEY_ROTATION_INTERVAL_DAYS=90

# =============================================================================
# PERFORMANCE & CACHING
# =============================================================================

# Enable Data Encryption Key (DEK) caching
ENABLE_DEK_CACHE=true

# DEK cache TTL (seconds)
DEK_CACHE_TTL_SECONDS=3600  # 1 hour

# Maximum DEK cache size (number of keys)
DEK_CACHE_MAX_SIZE=1000

# =============================================================================
# EMAIL CONFIGURATION (for password reset, verification)
# =============================================================================
SMTP_HOST=localhost
SMTP_PORT=1025                          # MailHog for development
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_FROM_EMAIL=noreply@rustcare.local
SMTP_FROM_NAME=RustCare Engine

# =============================================================================
# AUDIT CONFIGURATION
# =============================================================================
AUDIT_ENABLED=true
AUDIT_LOG_AUTHENTICATION=true
AUDIT_LOG_AUTHORIZATION=true
AUDIT_LOG_DATABASE_CHANGES=true
AUDIT_RETENTION_DAYS=90

# =============================================================================
# DEVELOPMENT FLAGS
# =============================================================================
DEV_MODE=true
DEV_RELOAD=true
DEV_PRETTY_LOGS=true
DEV_EXPOSE_ERRORS=true

# =============================================================================
# FEATURE FLAGS
# =============================================================================
FEATURE_MFA_ENABLED=true
FEATURE_OAUTH_ENABLED=true
FEATURE_CERTIFICATE_AUTH_ENABLED=false
FEATURE_API_DOCS_ENABLED=true
FEATURE_METRICS_ENABLED=true
